<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pt-br" lang="pt-br">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.75.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Go: comandos CLI, parte 2 &middot; DevDrops</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="http://devdrops.me/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="http://devdrops.me/css/poole.css">
  <link type="text/css" rel="stylesheet" href="http://devdrops.me/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="http://devdrops.me/css/hyde.css">
  <link type="text/css" rel="stylesheet" href="http://devdrops.me/css/authorbox.min.css">
  <link type="text/css" rel="stylesheet" href="http://devdrops.me/css/position.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  
</head>

  <body class=" ">
  
<aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://devdrops.me/"><h1>DevDrops</h1></a>
      <p class="lead">
      Site pessoal sobre tecnologia e outras coisas mais ;D
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="/about/"> Sobre </a></li><li><a href="/posts/"> Artigos </a></li><li><a href="/talks/"> Palestras </a></li>
      </ul>
    </nav>

    <p>Davi Moreira - @devdrops<br /> &copy; 2021. Todos os direitos reservados.</p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Go: comandos CLI, parte 2</h1>
  
  
  <time datetime=2021-01-20T00:00:00Z class="post-date">2021-01-20</time>
  
  <p>Dando sequ√™ncia do <a href="/posts/go-comandos-cli-parte-1/">artigo anterior</a>, veremos
mais detalhes de outros comandos da ferramenta CLI.</p>
<h3 id="go-env--json--u--w-var-"><code>go env [-json] [-u] [-w] [var ...]</code></h3>
<p>O comando <code>env</code> serve para descrever informa√ß√µes importantes da vers√£o de Go em
execu√ß√£o, como por exemplo vari√°veis de ambiente, informa√ß√µes de sistema
operacional, entre muitas outras.</p>
<p>O comando permite algumas op√ß√µes:</p>
<p><code>-json</code> define o formato de sa√≠da das informa√ß√µes. Por padr√£o, as informa√ß√µes
s√£o exibidas no formato shell, como uma s√©rie de vari√°veis de ambiente, por
exemplo. Usando essa op√ß√£o, os valores s√£o escritos no formato JSON, chave e
valor.</p>
<p>As op√ß√µes <code>-u</code> e <code>-w</code> s√£o as mais interessantes deste comando: servem para
definir ou desfazer valores das vari√°veis de ambiente usadas pela linguagem.
Para explicar melhor, cabe aqui um exemplo.</p>
<p>Vamos tomar por exemplo a vari√°vel <code>GOINSECURE</code> (introduzida na vers√£o 1.14,
serve para indicar dom√≠nios onde deve-se ignorar a aus√™ncia e validade de
certificados HTTPS no ato de obter m√≥dulos do mundo externo). Por padr√£o, na
vers√£o 1.15, ela vem definida da seguinte forma:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">GOINSECURE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
</code></pre></div><p>Caso voc√™ quiser inserir um dom√≠nio a ser inclu√≠do nessa regra, voc√™ pode
usar a op√ß√£o <code>-w</code>, que vai inserir o valor desejado conforme o exemplo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># A sintaxe deve ser VARIAVEL=valor</span>
go env -w GOINSECURE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;site.com&#34;</span>

<span style="color:#75715e"># Agora, go env vai exibir GOINSECURE=&#34;site.com&#34;</span>
</code></pre></div><p>Podemos passar uma lista de vari√°veis para alterar o valor.</p>
<p>J√° a op√ß√£o <code>-u</code> serve para devolver √† vari√°vel editada por <code>-w</code> seu valor
original:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># A sintaxe aqui deve ser s√≥ VARIAVEL</span>
go env -u GOINSECURE

<span style="color:#75715e"># Agora, go env vai exibir o valor original, GOINSECURE=&#34;&#34;</span>
</code></pre></div><p>Lembrando que  <code>-u</code> s√≥ funciona para vari√°veis editadas por <code>-w</code> üòâ</p>
<h3 id="go-fix-packages"><code>go fix [packages]</code></h3>
<p>Este √© um comando muito importante quando desejamos fazer atualiza√ß√µes de vers√£o
com seguran√ßa de que mudan√ßas na interface de packages n√£o ser√£o quebradas. O
<code>fix</code> identifica no pacote passado o uso de APIs antigas da linguagem e as
atualiza para vers√µes novas.</p>
<p>O comando oferece algumas op√ß√µes extras, mas que para serem usadas, devemos usar
o comando fix atrav√©s do comando <code>tool</code>, na forma <code>go tool fix</code>. Dessa forma, a
sintaxe do comando pode ser lida da seguinte forma:</p>
<p><code>go tool fix [-diff] [-r fixname,...] [-force fixname,...] [path ...]</code></p>
<p>A op√ß√£o <code>-diff</code> exibe as altera√ß√µes a fazer sem faz√™-las de fato. Uma excelente
forma de verificar antes se h√° mudan√ßas e quais ser√£o feitas!</p>
<p>A op√ß√£o <code>-r</code> aqui n√£o se trata de recursividade, mas sim de qual grupo de
rescritas dever√£o ser feitas. O comando <code>go tool fix -help</code> exibe a lista de
op√ß√µes e, por padr√£o, todos os grupos s√£o utilizados, mas podemos passar
somente um ou mais grupos se desejamos uma a√ß√£o mais espec√≠fica:</p>
<ul>
<li><code>cftype</code> para inicializadores e convers√µes de <em>C.*Ref</em> e tipos <em>JNI</em> (Java
Native Interface, uma forma de acessar c√≥digo Java atrav√©s do seu c√≥digo Go).</li>
<li><code>context</code> de <em>golang.org/x/net/context</em>.</li>
<li><code>egl</code> para inicializadores de EGLDisplay, da EGL API (<em>Embedded-System</em>
<em>Graphics Library</em>, de Android).</li>
<li><code>eglconf</code> para inicializadores de EGLConfig, da EGL API (<em>Embedded-System</em>
<em>Graphics Library</em>, de Android).</li>
<li><code>gotypes</code> de <em>golang.org/x/tools/go/{exact,types}</em>  para
<em>go/{constant,types}</em>.</li>
<li><code>jni</code> para inicializadores de jobjects e subtipos da <em>JNI</em>.</li>
<li><code>netipv6zone</code> para literais de <em>IPAddr</em>, <em>UDPAddr</em> ou <em>TCPAddr</em>.</li>
<li><code>printerconfig</code> que adiciona elementos para literais de <em>Config</em>.</li>
</ul>
<p>J√° a op√ß√£o <code>-force</code> √© como sugere: for√ßa a aplica√ß√£o de <code>fix</code>, mesmo se o c√≥digo
j√° foi atualizado.</p>
<p>Um detalhe importante: assim como muitas ferramentas, o comando n√£o oferece
nenhuma forma de backup. Ou seja, use um controle de vers√£o (git, svn, o que
preferir) antes de rodar o comando.</p>
<h3 id="go-fmt--n--x-packages"><code>go fmt [-n] [-x] [packages]</code></h3>
<p>O comando <code>fmt</code> executa uma an√°lise e corre√ß√£o de sintaxe padr√£o da linguagem.
Ao ser executado, o comando <code>gofmt -l -w</code> √© disparado nos pacotes passados no
comando, onde <code>-l</code> orienta a escrever o nome dos pacotes identificados para
altera√ß√£o e <code>-w</code> orienta a sobrescrever o arquivo quando encontrado. Ou seja, o
comando √© como um atalho para identifica√ß√£o e aplica√ß√£o de outra ferramenta,
<code>gofmt</code>, que √© a real ferramenta padr√£o de formata√ß√£o.</p>
<p>A op√ß√£o <code>-n</code> serve para exibir quais mudan√ßas poder√£o ser feitas, sem
aplic√°-las.</p>
<p>J√° a op√ß√£o <code>-x</code> escreve os comandos conforme s√£o executados.</p>
<p>H√° ainda uma terceira op√ß√£o, <code>-mod</code>, que funciona nas mesmas regras usadas no
comando <code>go build</code> s√≥ que aplicadas no contexto de <code>fmt</code>: define qual o tipo de
m√≥dulo onde se aplicar, <em>readonly</em> ou <em>vendor</em>.</p>
<h3 id="go-generate--run-regexp--n--v--x-build-flags-filego--packages"><code>go generate [-run regexp] [-n] [-v] [-x] [build flags] [file.go... | packages]</code></h3>
<p>O comando <code>generate</code> serve para executar comandos descritos nas diretivas
contidas dentro do seu c√≥digo Go. Por diretivas, estamos aqui falando de
instru√ß√µes contidas no c√≥digo, na forma <code>//go:generate comando argumento</code>.</p>
<p>Esses comandos podem executar quaisquer tarefas, mas no geral, s√£o usados para
alterar ou criar arquivos de c√≥digo Go. O <code>generate</code> faz uma an√°lise est√°tica dos
arquivos procurando por essas diretivas e, ao encontr√°-las, as executa.
Lembrando que o comando n√£o √© executado de forma autom√°tica por nenhum outro,
como <code>build</code> por exemplo; logo, se seu c√≥digo tem essas diretivas, este comando
deve ser sempre executado de forma expl√≠cita. Os comandos a serem executados
pelo <code>generate</code> podem ser chamadas √† bin√°rios que podem estar declarados em
<em>$PATH</em>, por caminho completo ou um atalho (ou <em>alias</em>).</p>
<p>Um detalhe importante: durante a execu√ß√£o, o comando <code>generate</code> pode definir
algumas vari√°veis de ambiente (daquela lista do <code>go env</code>, lembra?), como
<em>$GOARCH</em>, <em>$GOOS</em> entre outras, necess√°rias √† sua execu√ß√£o.</p>
<p>Pode-se tamb√©m usar a sintaxe <code>//go:generate -command bin√°rio argumentos</code>,
onde <code>-command</code> √© como uma <em>flag</em> indicando que a string <code>bin√°rio</code> √© um
comando seguido dos argumentos. Isso permite a cria√ß√£o de um atalho, que
poder√° ser usado em outras diretivas. Funciona assim: primeiro, usamos uma
diretiva como <code>//go:generate -command xablau go tool fix</code>, por exemplo. Com
essa diretiva declarada, podemos usar ent√£o a chamada √† <code>xablau</code> atrav√©s da
diretiva <code>//go:generate -command xablau ./daora.go</code>, como um atalho.</p>
<p>Um detalhe bacana: se a opera√ß√£o de uma diretiva sobre um dado <em>package</em>
retorna um erro, todas as execu√ß√µes desse <em>package</em> s√£o puladas, e o comando
parte para o pr√≥ximo <em>package</em>, se houver mais de um <em>package</em> declarado como
argumento.</p>
<p>Dado todas essas informa√ß√µes, vale lembrar que o comando tem uma √∫nica op√ß√£o,
<code>-run</code>. Por padr√£o, a op√ß√£o assume uma string vazia (<code>-run=&quot;&quot;</code>); mas, se
passamos algum valor, esse deve ser uma express√£o regular para identificar
algum padr√£o de arquivos a servirem como objeto da execu√ß√£o. H√° outras
op√ß√µes aceitas pelo comando, como <code>-v</code>, <code>-n</code> e <code>-x</code>, que funcionam da mesma
forma como s√£o declaradas nos demais comandos:</p>
<ul>
<li><code>-n</code> exibe o que ser√° feito sem de fato executar.</li>
<li><code>-v</code> excreve o nome dos <em>packages</em> conforme s√£o processados.</li>
<li><code>-x</code> escreve os comandos na ordem como s√£o executados.</li>
</ul>
<p>H√° tamb√©m a op√ß√£o de usar as mesmas op√ß√µes do comando <code>build</code>.</p>
<h3 id="go-get--d--f--t--u--v--fix--insecure-build-flags-packages"><code>go get [-d] [-f] [-t] [-u] [-v] [-fix] [-insecure] [build flags] [packages]</code></h3>
<p>O comando <code>get</code> serve para fazer o download de <em>packages</em> com base em seus
nomes completos de importa√ß√£o, e tamb√©m suas depend√™ncias, assim como o
<code>go install</code>. Este comando possui algumas op√ß√µes pr√≥prias, que valem a pena ser
entendidas:</p>
<p>A op√ß√£o <code>-d</code> instrui o comando a somente baixar os <em>packages</em>, sem instal√°-los.</p>
<p>A op√ß√£o <code>-u</code> diz para o comando usar a rede para atualizar os <em>packages</em> e suas
depend√™ncias. Nota-se que por padr√£o o <code>get</code> usa a rede para buscar <em>packages</em>
faltando, mas n√£o busca atualizar os que j√° tem. Logo, esta op√ß√£o √© bem poderosa
e deve ser usada com pondera√ß√£o.</p>
<p>A op√ß√£o <code>-f</code> s√≥ funciona em conjunto com a op√ß√£o <code>-u</code>, for√ßando <code>get -u</code> a n√£o
verificar se os <em>packages</em> envolvidos na a√ß√£o vieram de fato da origem descrita
no seu caminho de <em>import</em>. Isso permite pegar refer√™ncias locais ao inv√©s de
dados vindos do mundo externo, se assim desejarmos.</p>
<p>A op√ß√£o <code>-fix</code> aplica <code>go tool fix</code> nos <em>packages</em> baixados antes de resolver
suas depend√™ncias ou de seguir para o <em>build</em>.</p>
<p>A op√ß√£o <code>-insecure</code> instrui o comando a ignorar a aus√™ncia e/ou invalidade de
HTTPS nas origens do que voc√™ est√° baixando, semelhante √† <code>GOINSECURE</code> de que
falamos antes.</p>
<p>A op√ß√£o <code>-t</code> instrui para que, al√©m dos <em>packages</em> serem baixados, que os
<em>packages</em> necess√°rios para os testes do que foi baixado sejam baixados junto.</p>
<p>A op√ß√£o <code>-v</code> habilita a verbosidade do comando, escrevendo na sa√≠da o que est√°
sendo executado para o download.</p>
<p>Vale lembrar tamb√©m que <code>get</code> aceita as mesmas op√ß√µes do comando <code>build</code>.</p>
<p>Quando executado para baixar um novo <em>package</em>, <code>get</code> cria o diret√≥rio de
download em <code>GOPATH/src/&lt;import-path&gt;</code>, usando sempre a primeira entrada
presente em <code>GOPATH</code>, se tiver mais de uma. J√° quando <code>get</code> √© usado para conferir
ou atualizar um <em>package</em>, <code>get</code> procura na depend√™ncia um branch ou tag cujo
nome confere com a vers√£o de Go em execu√ß√£o. Se n√£o encontrar, o branch
principal do reposit√≥rio √© utilizado. Essa pode ser uma estrat√©gia interessante
para libs que desejam fazer experimentos usando <code>go2</code> por exemplo, deixando uma
branch com esse nome para ser identificada na execu√ß√£o de <code>get</code>, sem quebrar o
que j√° estiver em <code>main</code> por exemplo. Um outro detalhe √© que se o <em>package</em> a
ser baixado usar algum subm√≥dulo de git (uma forma de vincular reposit√≥rios
externos ao projeto como depend√™ncias diretas), esses subm√≥dulos tamb√©m ser√£o
baixados.</p>
<p>H√° mais informa√ß√µes relevantes sobre <code>get</code>. Por exemplo, o comando nunca confere
nem atualiza c√≥digo localizado dentro da pasta <code>vendor</code>. Al√©m disso, se a execu√ß√£o
est√° no modo <em>module-aware</em>, o comportamento de <code>get</code> e suas op√ß√µes pode mudar.
Como o uso de <code>GOPATH</code> √© mais antigo e considerado legado, √© importante conhecer as
diferen√ßas de execu√ß√£o do comando dependendo de seu contexto de execu√ß√£o.</p>
<p>Dentro do contexto de <em>module-aware</em>, a primeira a√ß√£o de <code>get</code> √© decidir quais
depend√™ncias ser√£o adicionadas. Para isso, o comando observa cada <em>package</em> e
busca por primeiro as informa√ß√µes de tags mais recentes. Se n√£o tiver tag
nenhuma no reposit√≥rio do <em>package</em>, o comando vai atr√°s do mais recente
commit. Claro, tudo isso se a vers√£o de m√≥dulo n√£o for definida logo de in√≠cio.
Toda esse mecanismo de escolha de vers√£o pode ser suprimido se colocamos um
<code>@vers√£o</code> no final do nome do <em>package</em> (<code>go get go.uber.org/zap@v1.15.0</code>, por
exemplo), ou ter somente parte da tag (<code>go get -u go.uber.org/zap@v1</code>, por
exemplo), fazendo assim que a √∫ltima vers√£o cuja tag come√ßa com <code>v1</code> seja
instalada (essa sintaxe √© chamada de <em>Module Queries</em>). A informa√ß√£o de vers√£o
de m√≥dulo pode tamb√©m usar o hash de commit, nome de branch, no caso de
<em>packages</em> hospedados em algum controle de vers√£o, como GitHub por exemplo.
Claro, desde que o sufixo (tag ou branch) n√£o tenha conflito com a sintaxe de
<em>Module Queries</em>.</p>
<p>H√° muitas outras diferen√ßas a se explorar entre contexto de <code>GOPATH</code> e de
<em>module-aware</em>, que por si s√≥ valem todo um texto individual. Se voc√™ tem
curiosidade, todas essas informa√ß√µes podem ser lidas ao executar o comando
<code>go help module-get</code>.</p>
<h3 id="go-install--i-build-flags-packages"><code>go install [-i] [build flags] [packages]</code></h3>
<p>O comando <code>install</code> compila e instala os <em>packages</em> nomeados pelo caminho de
<em>import</em>.</p>
<p>A op√ß√£o <code>-i</code> indica para o comando instalar tamb√©m as depend√™ncias dos
<em>packages</em> a instalar.</p>
<p>Al√©m dessa op√ß√£o, o comando tamb√©m aceita as mesmas op√ß√µes do comando
<code>build</code>.</p>
<hr>
<p>No pr√≥ximo artigo, fecharei com os √∫ltimos comandos: <code>list</code>, <code>mod</code>, <code>run</code>,
<code>test</code>, <code>tool</code>, <code>version</code> e <code>vet</code>.</p>
<h2 id="refer√™ncias">Refer√™ncias</h2>
<ul>
<li><a href="https://golang.org/doc/go1.14">https://golang.org/doc/go1.14</a></li>
<li><a href="https://fantashit.com/cmd-go-add-goinsecure-for-insecure-dependencies/">https://fantashit.com/cmd-go-add-goinsecure-for-insecure-dependencies/</a></li>
<li><a href="https://github.com/timob/jnigi">https://github.com/timob/jnigi</a></li>
<li><a href="https://golang.org/cmd/cgo/">https://golang.org/cmd/cgo/</a></li>
<li><a href="https://developer.android.com/reference/android/opengl/EGLDisplay">https://developer.android.com/reference/android/opengl/EGLDisplay</a></li>
</ul>

</div>

  
  
  
<div class="authorbox clearfix">
  <figure class="authorbox__avatar">
    <img alt="Davi Marcondes Moreira avatar" src="/me/me.jpeg" class="avatar" height="90" width="90">
  </figure>
  <div class="authorbox__header">
    <span class="authorbox__name">Sobre Davi Marcondes Moreira</span>
  </div>
  <div class="authorbox__description">
    Desenvolvedor de software, palestrante, evangelista de trabalho remoto e home office, amante de MTB/XCO e entusiasta de caf√©. Ele/Dele.
  </div>
</div>

  


    </main>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-77125737-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
  </body>
</html>
